<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

<div class="notch-container">
    <div class="notch-pill">
        {% set p = request.path %}
        
        <!-- Teacher Navigation -->
        <a href="{{ url_for('institution_teacher_dashboard') }}" class="notch-item {% if p == '/institution/teacher/dashboard' or p == '/' %}active{% endif %}">
            <span class="material-symbols-outlined">dashboard</span>
            <span class="notch-label">Teacher Dashboard</span>
        </a>
        <a href="{{ url_for('all_students') }}" class="notch-item {% if p.startswith('/institution/students') %}active{% endif %}">
            <span class="material-symbols-outlined">people</span>
            <span class="notch-label">Students</span>
        </a>
        <a href="{{ url_for('institution_teacher_classes') }}" class="notch-item {% if p.startswith('/institution/teacher/classes') %}active{% endif %}">
            <span class="material-symbols-outlined">class</span>
            <span class="notch-label">My Classes</span>
        </a>
        <a href="{{ url_for('institution_teacher_settings') }}" class="notch-item {% if p.startswith('/institution/teacher/settings') %}active{% endif %}">
            <span class="material-symbols-outlined">settings</span>
            <span class="notch-label">Settings</span>
        </a>
    </div>
</div>

<div class="action-buttons">
    <!-- THEME TOGGLE -->
    <button id="themeToggle" class="action-btn" title="Toggle Theme">
        <span class="material-symbols-outlined">dark_mode</span>
    </button>

    <!-- PROFILE DROPDOWN -->
    <div class="profile-dropdown">
        <button class="action-btn profile-btn" title="Profile Menu">
            {% if profile_picture %}
            <img src="{{ url_for('serve_profile_picture', filename=profile_picture.split('/')[1]) }}" alt="Profile" class="profile-avatar">
            {% else %}
            <span class="material-symbols-outlined">person</span>
            {% endif %}
        </button>
        <div class="dropdown-menu">
            <a href="{{ url_for('logout') }}" class="dropdown-item logout-item">
                <span class="material-symbols-outlined">logout</span>
                Logout
            </a>
            <a href="{{ url_for('contact') }}" class="dropdown-item">
                <span class="material-symbols-outlined">contact_support</span>
                Contact
            </a>
            <a href="{{ url_for('institution_teacher_settings') }}" class="dropdown-item">
                <span class="material-symbols-outlined">settings</span>
                Settings
            </a>
        </div>
    </div>
</div>

<script>
(function() {
    const root = document.documentElement;
    const toggle = document.getElementById("themeToggle");
    const icon = toggle ? toggle.querySelector('.material-symbols-outlined') : null;

    // Load saved theme
    const savedTheme = localStorage.getItem("sclera-theme");
    if (savedTheme) {
        root.setAttribute("data-theme", savedTheme);
        if (icon) {
            icon.textContent = savedTheme === 'dark' ? 'light_mode' : 'dark_mode';
        }
    } else {
        // Set default theme to dark
        root.setAttribute("data-theme", "dark");
        if (icon) {
            icon.textContent = 'dark_mode';
        }
    }

    // Theme toggle
    if (toggle) {
        toggle.addEventListener("click", () => {
            const current = root.getAttribute("data-theme") || 'dark';
            const next = current === "dark" ? "light" : "dark";

            root.setAttribute("data-theme", next);
            localStorage.setItem("sclera-theme", next);

            if (icon) {
                icon.textContent = next === 'dark' ? 'light_mode' : 'dark_mode';
            }
        });
    }

    // Profile dropdown
    const profileBtn = document.querySelector('.profile-btn');
    const dropdownMenu = document.querySelector('.dropdown-menu');

    if (profileBtn && dropdownMenu) {
        profileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            dropdownMenu.classList.remove('show');
        });

        // Close dropdown on menu item click
        dropdownMenu.addEventListener('click', (e) => {
            if (e.target.closest('.dropdown-item')) {
                dropdownMenu.classList.remove('show');
            }
        });
    }
})();
</script>
