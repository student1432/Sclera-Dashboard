<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <title>Admin Settings | StudyOS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <div class="dashboard-layout">
{% include '_admin_topnav.html' %}
        <main class="main-content">
            <h1>Institution Settings</h1>
            <p class="text-muted">Manage institution-wide configurations and permissions</p>

            <div class="inst-grid">
                <div class="island">
                    <h3>Institution Information</h3>
                    <p><strong>Name:</strong> {{ institution.get('name', 'N/A') }}</p>
                    <p><strong>ID:</strong> {{ institution_id }}</p>
                    <p><strong>Plan:</strong> {{ institution.get('plan', 'Free') }}</p>
                    <p><strong>Created:</strong> {{ institution.get('created_at', 'N/A') }}</p>
                </div>

                <div class="island">
                    <h3>Invite Codes</h3>
                    <p>Generate codes for students and teachers to join your institution.</p>
                    <button id="genInviteBtn" class="btn-primary">Generate New Code</button>
                </div>

                <div class="island">
                    <h3>Classes Overview</h3>
                    <p>Total Classes: {{ classes|length }}</p>
                    {% for cls in classes %}
                    <div class="class-row">
                        <span>{{ cls.get('name', cls.id) }}</span>
                        <span class="text-muted">{{ cls.get('students', [])|length }} students</span>
                    </div>
                    {% endfor %}
                </div>

                <div class="island">
                    <h3>Teacher Management</h3>
                    <p>Manage teacher accounts and permissions.</p>
                    <a href="{{ url_for('institution_admin_create_teacher_invite') }}" class="btn btn-secondary">Generate Teacher Invite</a>
                </div>

                <!-- NOTIFICATIONS ISLAND -->
                <div class="island">
                    <h3>Notifications</h3>
                    <form method="POST" action="{{ url_for('settings') }}">
                        <input type="hidden" name="action" value="general">

                        <div class="form-group checkbox-group" style="display:flex;align-items:center;gap:12px;">
                            <input type="checkbox" name="email_notifications" id="email_notifications"
                                {% if settings.get('email_notifications') %}checked{% endif %}
                                style="width:18px;height:18px;cursor:pointer;">
                            <label for="email_notifications" style="cursor:pointer;">
                                Email Notifications
                            </label>
                        </div>
                        <p class="form-hint" style="color:var(--text-muted);font-size:13px;margin-top:8px;">
                            Receive email updates about institution activity and student progress
                        </p>
                        <button type="submit" class="btn btn-primary" style="margin-top:16px;">Save Notifications</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.getElementById('genInviteBtn').onclick = async () => {
            const role = prompt("Role (student/teacher)?", "student");
            if (!role) return;
            const classId = prompt("Class ID (optional):", "");

            const formData = new FormData();
            formData.append('role', role);
            if (classId) formData.append('class_id', classId);

            const res = await fetch('/institution/generate_invite', {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            alert("Invite Code: " + data.code);
        };
    </script>
</body>

</html>
