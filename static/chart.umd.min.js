// Minimal Chart.js implementation for donut charts
(function() {
    'use strict';

    // Simple donut chart implementation
    function createDonutChart(canvas, data, options) {
        if (!canvas || !canvas.getContext) return;

        // Set canvas size if not set
        if (!canvas.width) canvas.width = 200;
        if (!canvas.height) canvas.height = 200;

        var ctx = canvas.getContext('2d');
        var centerX = canvas.width / 2;
        var centerY = canvas.height / 2;
        var radius = Math.min(centerX, centerY) * 0.8;
        var cutoutRadius = radius * (options.cutout ? parseFloat(options.cutout) / 100 : 0.5);

        var total = data.reduce(function(sum, value) { return sum + value; }, 0);
        var startAngle = -Math.PI / 2; // Start from top

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw segments
        for (var i = 0; i < data.length; i++) {
            var value = data[i];
            var sliceAngle = (value / total) * 2 * Math.PI;

            // Draw outer arc
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
            ctx.arc(centerX, centerY, cutoutRadius, startAngle + sliceAngle, startAngle, true);
            ctx.closePath();
            ctx.fillStyle = options.colors[i] || '#666666';
            ctx.fill();

            startAngle += sliceAngle;
        }

        // Draw center text if specified
        if (options.centerText) {
            ctx.fillStyle = '#000';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(options.centerText, centerX, centerY);
        }
    }

    // Chart constructor
    window.Chart = function(canvas, config) {
        this.canvas = canvas;
        this.config = config;
        this.render = function() {
            if (config.type === 'doughnut') {
                var data = config.data.datasets[0].data;
                var colors = config.data.datasets[0].backgroundColor;
                var cutout = config.options.cutout || '50%';
                var centerText = config.options.centerText;

                createDonutChart(canvas, data, {
                    colors: colors,
                    cutout: cutout.replace('%', ''),
                    centerText: centerText
                });
            }
        };

        // Auto-render
        this.render();
    };

    // Make Chart globally available
    if (typeof window !== 'undefined') {
        window.Chart = window.Chart || Chart;
    }

})();
